<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Nerd - Painel do Aluno</title>
    <link rel="stylesheet" href="css/aluno.css" />
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-content">
        <div style="display: flex; align-items: center; gap: 10px">
          <h2>ğŸ¤“ New Nerd</h2>
        </div>
        <div class="nav-user">
          <span id="alunoNome">Carregando...</span>
          <button class="btn-logout" onclick="logout()">Sair</button>
        </div>
      </div>
    </nav>

    <div class="container">
      <div class="painel-header">
        <h1 id="saudacao">OlÃ¡! ğŸ‘‹</h1>
        <p style="color: var(--text-secondary)">
          Aqui estÃ¡ o resumo dos seus estudos hoje.
        </p>

        <div class="stats-resumo">
          <div class="stat-box">
            <span class="stat-number" id="statsNivel">Nv. 1</span>
            <span class="stat-label">Meu NÃ­vel</span>
          </div>
          <div class="stat-box">
            <span class="stat-number" id="statsDesempenho">0%</span>
            <span class="stat-label">Aproveitamento</span>
          </div>
          <div class="stat-box">
            <span class="stat-number" id="statsQuestoes">0</span>
            <span class="stat-label">QuestÃµes Feitas</span>
          </div>
        </div>
      </div>

   <div class="dashboard-grid">
  <div class="main-actions">
    <div class="content-box">
      <h3 class="section-title">O que vamos estudar?</h3>
      <div class="questoes-grid">
        
        <div class="action-card" onclick="window.location.href='biblioteca.html'">
          <div class="action-icon">ğŸ“š</div>
          <h3>Biblioteca</h3>
          <p>Envie PDFs e estude.</p>
        </div>

        <div class="action-card" onclick="window.location.href='diagnostico.html'">
          <div class="action-icon">ğŸ§ </div>
          <h3>DiagnÃ³stico</h3>
          <p>Descubra seus pontos fortes.</p>
        </div>

        <div class="action-card" onclick="window.location.href='questao.html'">
          <div class="action-icon">ğŸ“</div>
          <h3>QuestÃµes</h3>
          <p>Pratique exercÃ­cios.</p>
        </div>

        <div class="action-card" onclick="window.location.href='contestacoes.html'">
          <div class="action-icon">âš–ï¸</div>
          <h3>ContestaÃ§Ãµes</h3>
          <p>Revise suas notas.</p>
        </div>

      </div>
    </div>
  </div>

  <div class="sidebar">
    <div class="content-box">
      <h3 class="section-title">Atividade Recente</h3>
      <div class="feedback-box" style="text-align: center; background: transparent">
        <p style="font-size: 0.9rem; color: var(--text-muted)">
          Nenhuma atividade recente encontrada.
        </p>
        <div style="font-size: 40px; margin-top: 20px; opacity: 0.5">ğŸ•’</div>
      </div>
    </div>
  </div>
</div>

    <button class="theme-toggle" id="themeToggle" title="Mudar Tema">â˜€ï¸</button>
    <button
      class="chat-widget-btn"
      onclick="toggleChat()"
      title="Falar com New Nerd"
    >
      ğŸ¤–
    </button>
    <div class="chat-modal" id="chatModal">
      <iframe
        src="chat-aluno.html"
        class="chat-frame"
        style="width: 100%; height: 100%; border: none"
      ></iframe>
    </div>

    <script src="js/config.local.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        // Auth e Stats
        const aluno = await verificarAuth();
        if (aluno) {
          const nome = aluno.nome ? aluno.nome.split(" ")[0] : "Estudante";
          document.getElementById("alunoNome").textContent = nome;
          document.getElementById("saudacao").textContent = `OlÃ¡, ${nome}! ğŸ‘‹`;
          carregarStats(aluno.id);
        }

        // Dark Mode Logic
        const themeBtn = document.getElementById("themeToggle");
        const body = document.body;

        function updateIcon(theme) {
          themeBtn.textContent = theme === "dark" ? "ğŸŒ™" : "â˜€ï¸";
        }

        themeBtn.addEventListener("click", () => {
          const current = body.getAttribute("data-theme");
          const novo = current === "dark" ? "light" : "dark";
          body.setAttribute("data-theme", novo);
          localStorage.setItem("newnerd_theme", novo);
          updateIcon(novo);
        });

        const salvo = localStorage.getItem("newnerd_theme");
        if (salvo) {
          body.setAttribute("data-theme", salvo);
          updateIcon(salvo);
        }
      });

      async function carregarStats(id) {
        const { count } = await window.supabaseClient
          .from("respostas_alunos")
          .select("*", { count: "exact", head: true })
          .eq("aluno_id", id);
        if (count) document.getElementById("statsQuestoes").textContent = count;
      }

      function toggleChat() {
        document.getElementById("chatModal").classList.toggle("active");
      }
    </script>
  </body>
</html>
